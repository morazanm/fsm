#lang racket

(#%declare #:unsafe)

(require ;"../fsm-gviz/private/lib.rkt"
         ;2htdp/universe
         2htdp/image)


(define TEST-SAVE-DIR "/home/sora/Documents/demo-folder/")
(define SCRIPT-LOCATION "/home/sora/Documents/demo-folder/create-image-p.sh")

;; nat lengthof listofgraphs
;; make this a for loop TODO
(define (collect-images accum cap)
  (if (> accum cap)
      '()
      (cons (bitmap/file (string->path (format "~adot~s.png" TEST-SAVE-DIR accum)))
            (collect-images (add1 accum) cap)
            )
      )
  )

(define (parallel-dot2 graphs) (let* [
                                    (graphs-length 92)
                                    (list-dot-files (for/list ([i (range 1 (add1 graphs-length))])
                                                      (format "~adot~s" TEST-SAVE-DIR i)
                                                      )
                                                    )
                                    ;(fh-dot-files (take (/ graphs-length 2)list-dot-files))
                                    ;(lh-dot-files (drop (length fh-dot-files) list-dot-files))
                                    
                                    ]
                                (begin
                                  #;(foldl (lambda (value accum)
                                           (begin (graph->dot value (string->path TEST-SAVE-DIR) (format "dot~s" accum))
                                                  (add1 accum)
                                                  )
                                           )
                                         1
                                         graphs)
                                  
                                  #;(system (format "~s ~s ~s" SCRIPT-LOCATION 1 graphs-length))
                                  
                                  (map (lambda (dot-path) (system (format "~a -T~s ~s -o ~s"
                                                                          ;; On Mac/Linux we can bypass having to look at the systems PATH by instead
                                                                          ;; using the absolute path to the executable. For unknown reasons this does not
                                                                          ;; work on Windows so we will still use the PATH to call the dot executable
                                                                          "/run/current-system/sw/bin/dot"
                                                                          'png
                                                                          (string-append dot-path ".dot")
                                                                          (string-append dot-path ".png")
                                                                          )
                                                                  )
                                         )
                                       list-dot-files)
                                        
                                   (collect-images 1 graphs-length)
                                  ;(map graph->bitmap graphs)
                                  )
                                )
  )

(time (parallel-dot2 '()))